<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/e8febeb6730d7a7bce46.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e8febeb6730d7a7bce46.css" data-n-g=""/><link rel="preload" href="/_next/static/css/8189cb58e298e1a5e388.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8189cb58e298e1a5e388.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.c4db113d6ae1605f54bb.js" as="script"/><link rel="preload" href="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.3017f9b6be27c667c533.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-c129779407ff225e84bd.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-296f3014e90507873ea9.js" as="script"/><link rel="preload" href="/_next/static/chunks/1df474da.d95f8884482661656c51.js" as="script"/><link rel="preload" href="/_next/static/chunks/1bb37dfa4a3d16451abcd7ba6f75b92f45ed2736.23a21b264878a7c00596.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/%5Bid%5D-41af1dbfc4675f634447.js" as="script"/></head><body><div id="__next"><div class=".app"><div class="styles_header__2KtfL"><div class="styles_logo__KwRGz"><a href="/"><img alt="logo" src="/logo.svg"/></a></div></div><div class="content"></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"dir":"925-extreme-assert-array-index","id":"925","challenge":"extreme","info":{"difficulty":"extreme","title":"Assert Array Index","tags":"array","tsconfig":{"noUncheckedIndexedAccess":true},"author":{"github":"uid11","name":null}},"prefix":"\u003c!--info-header-start--\u003e\u003ch1\u003eAssert Array Index \u003cimg src=\"https://img.shields.io/badge/-extreme-b11b8d\" alt=\"extreme\"/\u003e \u003cimg src=\"https://img.shields.io/badge/-%23array-999\" alt=\"#array\"/\u003e\u003c/h1\u003e\u003cblockquote\u003e\u003cp\u003eby null \u003ca href=\"https://github.com/uid11\" target=\"_blank\"\u003e@uid11\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\u003cp\u003e\u003ca href=\"https://tsch.js.org/925/play\" target=\"_blank\"\u003e\u003cimg src=\"https://img.shields.io/badge/-Take%20the%20Challenge-3178c6?logo=typescript\u0026logoColor=white\" alt=\"Take the Challenge\"/\u003e\u003c/a\u003e \u003c/p\u003e\u003c!--info-header-end--\u003e\r\n\r\nSometimes we want to use the good old `for`-loop with an index to traverse the array, but in this case TypeScript does not check in any way that we are accessing the elements of the array at its real index (not exceeding the length of the array), and that we are not using an arbitrary number as an index, or index from another array (for nested loops, for traversing matrices or graphs):\r\n```ts\r\nconst matrix = [\r\n    [3, 4],\r\n    [5, 6],\r\n    [7, 8],\r\n];\r\n\r\n// This example contains no type errors when the noUncheckedIndexedAccess option is off.\r\nfor (let i = 0; i \u003c matrix.length; i += 1) {\r\n    const columns: number[] = matrix[i];\r\n\r\n    for (let j = 0; j \u003c columns.length; j += 1) {\r\n        const current: number = columns[i]; // oops! i instead of j\r\n\r\n        console.log(\r\n            current.toFixed(), // TypeError: Cannot read property 'toFixed' of undefined\r\n        );\r\n    }\r\n}\r\n```\r\n\r\nYou can enable the [noUncheckedIndexedAccess](https://www.typescriptlang.org/tsconfig#noUncheckedIndexedAccess) option (in `tsconfig.json`), but then each time you access an array element, you will need to check that this element exists, which is somewhat verbose and inconvenient, especially since in the case of such a `for`-traversal, we are sure that the index does not exceed the length of the array:\r\n```ts\r\nconst numbers = [5, 7];\r\n\r\nfor (let i = 0; i \u003c numbers.length; i += 1) {\r\n    const current = numbers[i];\r\n\r\n    if (current !== undefined) {\r\n        console.log(current.toFixed());\r\n    }\r\n}\r\n```\r\n\r\nWrite an `assert`-function `assertArrayIndex(array, key)` that can be applied to any `array` (with an arbitrary unique string `key`, which is needed to distinguish arrays at the type level) to allow access to the elements of this array only by the index obtained from array by the special generic type `Index\u003ctypeof array\u003e` (this functionality requires enabling the [noUncheckedIndexedAccess](https://www.typescriptlang.org/tsconfig#noUncheckedIndexedAccess) option in `tsconfig.json`):\r\n```ts\r\nconst numbers = [5, 7];\r\n\r\nassertArrayIndex(numbers, 'numbers');\r\n\r\nfor (let i = 0 as Index\u003ctypeof numbers\u003e; i \u003c numbers.length; i += 1) {\r\n    console.log(numbers[i].toFixed());\r\n}\r\n```\r\n\r\nWhen accessing by such an index, it must be guaranteed that an element in the array exists, and when accessing an array by any other indices, there is no such guarantee (the element may not exist):\r\n```ts\r\nconst matrix = [\r\n    [3, 4],\r\n    [5, 6],\r\n    [7, 8],\r\n];\r\n\r\nassertArrayIndex(matrix, 'rows');\r\n\r\nlet sum = 0;\r\n\r\nfor (let i = 0 as Index\u003ctypeof matrix\u003e; i \u003c matrix.length; i += 1) {\r\n    const columns: number[] = matrix[i];\r\n\r\n    // @ts-expect-error: number | undefined in not assignable to number\r\n    const x: number[] = matrix[0];\r\n\r\n    assertArrayIndex(columns, 'columns');\r\n\r\n    for (let j = 0 as Index\u003ctypeof columns\u003e; j \u003c columns.length; j += 1) {\r\n        sum += columns[j];\r\n\r\n        // @ts-expect-error: number | undefined in not assignable to number\r\n        const y: number = columns[i];\r\n\r\n        // @ts-expect-error: number | undefined in not assignable to number\r\n        const z: number = columns[0];\r\n\r\n        // @ts-expect-error: number[] | undefined in not assignable to number[]\r\n        const u: number[] = matrix[j];\r\n    }\r\n}\r\n```\r\n\r\nThe `assertArrayIndex` function cannot be called on tuples (since the accessing the elements is already well typed in them):\r\n```ts\r\nconst tuple = [5, 7] as const;\r\n\r\n// @ts-expect-error\r\nassertArrayIndex(tuple, 'tuple');\r\n```\r\n\r\n(Additional design considerations for the proposed API: [#925](https://github.com/type-challenges/type-challenges/issues/925#issuecomment-780889329).)\r\n\r\n\r\n\u003c!--info-footer-start--\u003e\u003cbr\u003e\u003ca href=\"../../README.md\" target=\"_blank\"\u003e\u003cimg src=\"https://img.shields.io/badge/-Back-grey\" alt=\"Back\"/\u003e\u003c/a\u003e \u003ca href=\"https://tsch.js.org/925/answer\" target=\"_blank\"\u003e\u003cimg src=\"https://img.shields.io/badge/-Share%20your%20Solutions-teal\" alt=\"Share your Solutions\"/\u003e\u003c/a\u003e \u003ca href=\"https://tsch.js.org/925/solutions\" target=\"_blank\"\u003e\u003cimg src=\"https://img.shields.io/badge/-Check%20out%20Solutions-de5a77?logo=awesome-lists\u0026logoColor=white\" alt=\"Check out Solutions\"/\u003e\u003c/a\u003e \u003c!--info-footer-end--\u003e\r\n","suffix":"const matrix = [\r\n    [3, 4],\r\n    [5, 6],\r\n    [7, 8],\r\n];\r\n\r\nassertArrayIndex(matrix, 'rows');\r\n\r\nlet sum = 0;\r\n\r\nfor (let i = 0 as Index\u003ctypeof matrix\u003e; i \u003c matrix.length; i += 1) {\r\n    const columns: number[] = matrix[i];\r\n\r\n    // @ts-expect-error: number | undefined in not assignable to number\r\n    const x: number[] = matrix[0];\r\n\r\n    assertArrayIndex(columns, 'columns');\r\n\r\n    for (let j = 0 as Index\u003ctypeof columns\u003e; j \u003c columns.length; j += 1) {\r\n        sum += columns[j];\r\n\r\n        // @ts-expect-error: number | undefined in not assignable to number\r\n        const y: number = columns[i];\r\n\r\n        // @ts-expect-error: number | undefined in not assignable to number\r\n        const z: number = columns[0];\r\n\r\n        // @ts-expect-error: number[] | undefined in not assignable to number[]\r\n        const u: number[] = matrix[j];\r\n    }\r\n}\r\n\r\nconst a: string[] = [];\r\n\r\nassertArrayIndex(a, 'a');\r\n\r\nfor (let p = 0 as Index\u003ctypeof a\u003e; p \u003c a.length; p += 1) {\r\n    const value: string = a[p];\r\n\r\n    // @ts-expect-error: string | undefined is not assignable to string\r\n    const z: string = a[2];\r\n}\r\n\r\na.push('qux');\r\n// @ts-expect-error: number is not assignable to string\r\na.push(3);\r\n\r\nfor (const value of a) {\r\n    const other: string = value;\r\n}\r\n\r\nconst b: number[] = [];\r\n\r\nassertArrayIndex(b, 'b');\r\n\r\nfor (let p = 0 as Index\u003ctypeof a\u003e; p \u003c b.length; p += 1) {\r\n    // @ts-expect-error: number | undefined is not assignable to string\r\n    const value: string = b[p];\r\n}\r\n\r\nconst c: string[] = [];\r\n\r\nassertArrayIndex(c, 'c');\r\n\r\nfor (let p = 0; p \u003c c.length; p += 1) {\r\n    // @ts-expect-error: string | undefined is not assignable to string\r\n    let value: string = c[p];\r\n\r\n    // @ts-expect-error: string | undefined is not assignable to string\r\n    value = c[0 as Index\u003ctypeof a\u003e];\r\n}\r\n\r\nconst d: readonly number[] = [];\r\n\r\nassertArrayIndex(d, 'd');\r\n\r\nfor (let p = 0 as Index\u003ctypeof d\u003e; p \u003c d.length; p += 1) {\r\n    const value: number = d[p];\r\n\r\n    // @ts-expect-error: only permits reading\r\n    d[2] = 3;\r\n}\r\n\r\n// @ts-expect-error: push does not exist on readonly\r\nd.push(3);\r\n\r\nconst e: [number] = [0];\r\n\r\n// @ts-expect-error: [number] is not assignable to never\r\nassertArrayIndex(e, 'e');\r\n\r\nconst f: readonly [boolean] = [false];\r\n\r\n// @ts-expect-error: [boolean] is not assignable to never\r\nassertArrayIndex(f, 'f');\r\n\r\nconst tuple = [5, 7] as const;\r\n\r\n// @ts-expect-error: readonly [5, 7] is not assignable to never\r\nassertArrayIndex(tuple, 'tuple');\n","content":"function assertArrayIndex(array: readonly unknown[], key: string) {}\r\n\r\ntype Index\u003cArray\u003e = any\n"},"__N_SSG":true},"page":"/[id]","query":{"id":"925-extreme-assert-array-index"},"buildId":"UhjACfgIYlGKTYHX6L_ZR","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-076e78994db3acc22a9f.js"></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.c4db113d6ae1605f54bb.js" async=""></script><script src="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.3017f9b6be27c667c533.js" async=""></script><script src="/_next/static/chunks/main-c129779407ff225e84bd.js" async=""></script><script src="/_next/static/chunks/pages/_app-296f3014e90507873ea9.js" async=""></script><script src="/_next/static/chunks/1df474da.d95f8884482661656c51.js" async=""></script><script src="/_next/static/chunks/1bb37dfa4a3d16451abcd7ba6f75b92f45ed2736.23a21b264878a7c00596.js" async=""></script><script src="/_next/static/chunks/pages/%5Bid%5D-41af1dbfc4675f634447.js" async=""></script><script src="/_next/static/UhjACfgIYlGKTYHX6L_ZR/_buildManifest.js" async=""></script><script src="/_next/static/UhjACfgIYlGKTYHX6L_ZR/_ssgManifest.js" async=""></script></body></html>